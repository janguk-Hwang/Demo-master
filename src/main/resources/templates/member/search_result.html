<!doctype html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>검색 결과 페이지</title>
    <link rel="shortcut icon" type="image/x-icon" href="/Logo.png">
    <style>
        .grid-container {
            display: flex;
            align-content: center;
            align-items: center;
            gap: 10px;
            padding: 10px;
        }
        .grid-container > div{
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 0px;
            border-radius: 20px;
            background-color: #f2f2f2;
            text-align: justify;
            padding: 0 10px;
            font-family: "Lato",sans-serif;
            font-size: 20px;
        }
        #chart1 {
            width: 90%;
            height: 350px;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            box-sizing: border-box;
        }

        #chart2 {
            width: 90%;
            height: 350px;
            background-color: #f9f9f9;
            border: 1px solid #ccc;
            border-radius: 10px;
            padding: 20px;
            box-sizing: border-box;
        }
        .card {
            background: #fff;
            border-radius: 2px;
            display: inline-block;
            height: 300px;
            position: relative;
            width: 90%;
        }
        .card-4 {
            box-shadow: 0 14px 28px rgba(0,0,0,0.25), 0 10px 10px rgba(0,0,0,0.22);
        }
        hr.hr-1 {
            border: 0;
            height: 1px;
            background-image: linear-gradient(to right, rgba(0, 0, 0, 0), rgba(0, 0, 0, 0.75), rgba(0, 0, 0, 0));
        }
        body {
            background: #f2f2f2;
        }
        p {
            font-family: 'Lato', sans-serif;
            font-weight: 300;
            text-align: center;
            font-size: 18px;
            color: #676767;
        }
        button {
            margin: 20px;
        }
        .custom-btn {
            width: 160px;
            height: 40px;
            color: #fff;
            border-radius: 10px;
            padding: 10px 25px;
            font-family: '한컴 말랑말랑 Regular', sans-serif;
            font-size: 16px;
            font-weight: 900;
            font-style: normal;
            text-shadow: 0px -1px 0px rgba(0,0,0,0.4);
            text-decoration: none;
            background: transparent;
            cursor: pointer;
            position: relative;
            display: inline-block;
            box-shadow: inset 0px 1px 0px rgba(255,255,255,1),0px 1px 3px rgba(0,0,0,0.3);
            outline: none;
            border: 1px solid #ba6;
        }
        .custom-btn:active{
            -webkit-transform: translateY(2px);
            transform: translateY(2px);
        }
        /* 7 */
        .btn-7{
            border-color: #7c7c7c;
            background: -webkit-gradient(linear, left top, left bottom, from(rgba(0, 0, 0, 0.25)), to(#e6e6e6));
        }
        body {
            text-align: center;
            flex-flow: wrap;
            font-size: 17px;
            font-family: 'Titillium Web', sans-serif;
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script th:inline="javascript">
        var myChart1;
        var myChart2;

        window.addEventListener('resize', function() {
            myChart1.resize();
            myChart2.resize();
        });

        window.onload = function() {
            document.getElementById("drawLine").addEventListener('click', function() {
                drawChart1('line');
                drawChart2('line');
            });
            document.getElementById("drawBar").addEventListener('click', function() {
                drawChart1('bar');
                drawChart2('bar');
            });

            drawChart1('line');
            drawChart2('line');
        };

        function drawChart1(type) {
            myChart1 = echarts.init(document.getElementById('chart1'));

            var xAxisData = [[${xAxisData}]];
            let seriesData1 = [[${seriesData1}]];
            let seriesData2 = [];
            let seriesData3 = [];
            let seriesData4 = [];
            let seriesData5 = [];

            if ([[${query2}]]!="") {
                seriesData2 = [[${seriesData2}]];
            }

            if ([[${query3}]]!="") {
                seriesData3 = [[${seriesData3}]];
            }

            if ([[${query4}]]!="") {
                seriesData4 = [[${seriesData4}]];
            }

            if ([[${query5}]]!="") {
                seriesData5 = [[${seriesData5}]];
            }

            let legendData = []; // 범례 데이터를 동적으로 저장할 배열

            if ([[${query1}]] !== "") {
                legendData.push('[[${query1}]]');
            }
            if ([[${query2}]]!="") {
                legendData.push('[[${query2}]]');
            }
            if ([[${query3}]]!="") {
                legendData.push('[[${query3}]]');
            }
            if ([[${query4}]]!="") {
                legendData.push('[[${query4}]]');
            }
            if ([[${query5}]]!="") {
                legendData.push('[[${query5}]]');
            }

            let option = {
                tooltip: {
                    trigger: 'item',
                    position: function (point, params, dom, rect, size) {
                        var x = 150; // x 좌표 조절
                        var y = 50; // y 좌표 조절
                        console.log(point[0])
                        if(point[0]<510){
                            return [point[0], point[1] - y];
                        } else if (point[0]>510){
                            return [point[0]-x, point[1] - y];
                        }
                    }
                },
                grid: {
                    left: '1%',
                    right: '4%',
                    bottom: '10%',
                    top: '10%',
                    containLabel: true
                },
                legend: {
                    data: legendData
                },
                xAxis: {
                    type: 'category',
                    data: xAxisData
                },
                yAxis: {
                    type: 'value'
                },
                series: [
                    {
                        name: '[[${query1}]]',
                        data: seriesData1,
                        type: type,
                        color: 'rgb(255, 0, 0)'
                    },
                    {
                        name: '[[${query2}]]',
                        data: seriesData2,
                        type: type,
                        color: 'rgb(200, 200, 0)'
                    },
                    {
                        name: '[[${query3}]]',
                        data: seriesData3,
                        type: type,
                        color: 'rgb(0, 200, 200)'
                    },
                    {
                        name: '[[${query4}]]',
                        data: seriesData4,
                        type: type,
                        color: 'rgb(0, 100, 235)'
                    },
                    {
                        name: '[[${query5}]]',
                        data: seriesData5,
                        type: type,
                        color: 'rgb(200, 200, 255)'
                    }
                ],
                label: {
                    show: false,
                    position: 'top',
                }
            };
            myChart1.setOption(option);
        }

        function drawChart2(type) {
            myChart2 = echarts.init(document.getElementById('chart2'));

            var xAxisData = [[${xAxis2Data}]];
            let seriesData1 = [[${series2Data1}]];
            let seriesData2 = [];
            let seriesData3 = [];
            let seriesData4 = [];
            let seriesData5 = [];

            if ([[${query2}]]!="") {
                seriesData2 = [[${series2Data2}]];
            }

            if ([[${query3}]]!="") {
                seriesData3 = [[${series2Data3}]];
            }

            if ([[${query4}]]!="") {
                seriesData4 = [[${series2Data4}]];
            }

            if ([[${query5}]]!="") {
                seriesData5 = [[${series2Data5}]];
            }

            let legendData = []; // 범례 데이터를 동적으로 저장할 배열

            if ([[${query1}]] !== "") {
                legendData.push('[[${query1}]]');
            }
            if ([[${query2}]]!="") {
                legendData.push('[[${query2}]]');
            }
            if ([[${query3}]]!="") {
                legendData.push('[[${query3}]]');
            }
            if ([[${query4}]]!="") {
                legendData.push('[[${query4}]]');
            }
            if ([[${query5}]]!="") {
                legendData.push('[[${query5}]]');
            }

            let option = {
                tooltip: {
                    trigger: 'item',
                    position: function (point, params, dom, rect, size) {
                        var x = 150; // x 좌표 조절
                        var y = 50; // y 좌표 조절
                        console.log(point[0])
                        if(point[0]<510){
                            return [point[0], point[1] - y];
                        } else if (point[0]>510){
                            return [point[0]-x, point[1] - y];
                        }
                    }
                },
                grid: {
                    left: '1%',
                    right: '4%',
                    bottom: '10%',
                    top: '10%',
                    containLabel: true
                },
                legend: {
                    data: legendData
                },
                xAxis: {
                    type: 'category',
                    data: xAxisData
                },
                yAxis: {
                    type: 'value'
                },
                series: [
                    {
                        name: '[[${query1}]]',
                        data: seriesData1,
                        type: type,
                        color: 'rgb(255, 0, 0)'
                    },
                    {
                        name: '[[${query2}]]',
                        data: seriesData2,
                        type: type,
                        color: 'rgb(200, 200, 0)'
                    },
                    {
                        name: '[[${query3}]]',
                        data: seriesData3,
                        type: type,
                        color: 'rgb(0, 200, 200)'
                    },
                    {
                        name: '[[${query4}]]',
                        data: seriesData4,
                        type: type,
                        color: 'rgb(0, 100, 235)'
                    },
                    {
                        name: '[[${query5}]]',
                        data: seriesData5,
                        type: type,
                        color: 'rgb(200, 200, 255)'
                    }
                ],
                label: {
                    show: false,
                    position: 'top',
                }
            };
            myChart2.setOption(option);
        }
    </script>
</head>
<body>
<a href="/index_result" target="_blank">
    <img src="/Logo.png" alt="Leto 데이터랩 로고" height="146" width="255">
</a>
<div class="grid-container">
    <div>
        <a>&nbsp</a><a>&nbsp</a><a>&nbsp</a><a>&nbsp</a><a>&nbsp</a><a>&nbsp</a><a>&nbsp</a><a>&nbsp</a>
        <button class="custom-btn btn-7" id="drawLine" value="line">Line Chart</button>
        <button class="custom-btn btn-7" id="drawBar" value="bar">Bar Chart</button>
        <button class="custom-btn btn-7" onclick="window.location.href='/index_result'">검색화면으로</button>
        <form method="post"><button class="custom-btn btn-7" type="submit" name="addFavorite" value="1">즐겨찾기 추가</button></form>
    </div>
</div>
<div class="card card-4" id="chart1"></div>
<h1></h1>
<div class="card card-4" id="chart2"></div>
</body>
</html>